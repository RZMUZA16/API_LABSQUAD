// ============================================
// Prisma Schema - Sistem Poin Lab & Sertifikat
// ============================================

// Prisma Client Generator
generator client {
  provider = "prisma-client-js"
}

// Database Connection
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//ENUM
enum status_sertifikat {
  Menunggu
  Diterima
  Ditolak
}

enum user_role {
  MAHASISWA
  DOSEN
  KAPLAB
}

//MODEL
model User {
  id           Int                @id @default(autoincrement())
  nama         String
  email        String             @unique
  password     String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  user_role    user_role          @default(MAHASISWA)
  secret_key   String?            @unique

  // Relasi
  sertifikatUser   SertifikatUser[]
}


model Sertifikat {
  id           Int                   @id @default(autoincrement())
  nama         String
  deskripsi    String?
  createdAt    DateTime              @default(now())
  status       status_sertifikat     @default(Menunggu)

  // Relasi
  sertifikatUser     SertifikatUser[]
  poinLab            PoinLab[]
}


model PoinLab {
  id             Int          @id @default(autoincrement())
  sertifikatId   Int
  activityId     Int?
  poin           Int
  createdAt      DateTime     @default(now())

  // Relasi
  sertifikat     Sertifikat   @relation(fields: [sertifikatId], references: [id])
  activity       Activity?    @relation(fields: [activityId], references: [id])
}

model Activity {
  id                    Int                   @id @default(autoincrement())
  nama_activity         String
  deskripsi_activity    String?
  poin_default          Int                   @default(0)
  is_active             Boolean               @default(true)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  // Relasi
  poinLab               PoinLab[]
}

//RELASI
model SertifikatUser {
  id             Int         @id @default(autoincrement())
  userId         Int
  sertifikatId   Int

  user           User        @relation(fields: [userId], references: [id])
  sertifikat     Sertifikat  @relation(fields: [sertifikatId], references: [id])
}
